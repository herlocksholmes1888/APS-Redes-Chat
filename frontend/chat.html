<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cal+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./chat.css">
    <link rel="icon" href="./img/icon.png" type="image/png">
    <title>Ecomunications | Chat </title>
</head>
<body>
    <!-- Estes dados devem ser dinâmicos no futuro. Deve haver uma interação com a base de dados para preencher a foto, o nome e o status do destinatário -->
    <div class="container-destinatario">
        <div class="informacoes-destinatario">
            <div class="foto-destinatario">
                <label for="file-input">
                    <img id="preview" src="./img/add-picture.png" alt="Foto do destinatário" style="cursor: pointer; width: 90px; height: 90px; border-radius: 50%;" />
                </label>
                <input id="file-input" type="file" accept="image/*" style="display: none;" />
            </div>

            <div class="dados-escritos-destinatario">
                <div class="nome-destinatario">
                    <h2>José da Silva</h2>
                </div>

                <div class="status-destinatario">
                    <p>Online</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- A quantidade de mensagens deve ser dinâmica no futuro. Deve haver um template através do qual todas as mensagens são tratadas e, então, são mostradas na tela dentro desses templates -->
    <div class="chat">
        <div class="container-mensagens-remetente">
            <div class="speech-bubble-remetente">
                <div class="mensagem">
                    <p>Oi, tudo bem?</p>
                </div>
            </div>
        </div>

        <div class="container-mensagens-destinatario">
            <div class="speech-bubble-destinatario">
                <div class="mensagem">
                    <p>Tudo, e você?</p>
                </div>
            </div>
        </div>
    </div>

    <div class="teclado">
        <textarea placeholder="Escreva alguma coisa..."></textarea>
        <button type="submit">Enviar</button>
    </div>
</body>
<script>
    const textarea = document.querySelector('textarea');
    const button = document.querySelector('button');
    const input = document.getElementById('file-input');
    const preview = document.getElementById('preview');

    // Permite que o usuário adicione uma nova imagem para o destinatário
    input.addEventListener('change', (e) => {
        const file = e.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(evt) {
                preview.src = evt.target.result; 
            };
            reader.readAsDataURL(file);
        }
    });


    // Envio de novas mensagens
    button.addEventListener('click', () => {
        const message = textarea.value;
        if (message.trim() !== '') {
            const chat = document.querySelector('.chat');
            const newMessage = document.createElement('div');
            newMessage.classList.add('container-mensagens-remetente');
            newMessage.innerHTML = `
                <div class="speech-bubble-remetente">
                    <div class="mensagem">
                        <p>${message}</p>
                    </div>
                </div>
                <br>
            `;
            chat.appendChild(newMessage);
            textarea.value = '';
        }
    });

    // Envio de novas mensagens através do Enter
    // Ainda é possível acrescentar um novo parágrafo se
    // for utilizada a tecla Shift + Enter
    textarea.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            button.click();
        }
    });
</script>
</html>